(function(){if(typeof window.iwArgsClassic!="undefined"){var e=window.iwArgsClassic||{},u=document.querySelector(".iw-classic-actions");if(u){var f=u.querySelector(".iw-classic-status"),d=u.querySelector(".iw-classic-apply"),l=u.querySelector(".iw-classic-remove"),m=!1,i=function(t,r){f&&(f.textContent=t||"",f.className="iw-classic-status",r&&f.classList.add(r))},w=function(t){d&&(d.disabled=t),l&&(l.disabled=t)},g=function(t){return Object.keys(t).map(function(r){return encodeURIComponent(r)+"="+encodeURIComponent(t[r])}).join("&")},v=function(){var t=["#attachment-preview img",".attachment-info .thumbnail img",".attachment-media-view img",".attachment-info img",".wp_attachment_holder img"];t.forEach(function(r){var c=document.querySelector(r);if(c&&c.src){var n=Date.now(),a=c.src.indexOf("?")===-1?"?":"&";c.src=""+c.src+a+"t="+n}})},p=function(t){if(!m&&e.attachmentId){m=!0,w(!0),i(e.strings.running||"","info");var r=g({action:"iw_watermark_bulk_action","iw-action":t,attachment_id:e.attachmentId,_iw_nonce:e.nonce}),c=function(){m=!1,w(!1)};if(window.fetch)window.fetch(e.ajaxUrl,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:r}).then(function(a){return a.json()}).then(function(a){if(a&&a.success){var o=t==="applywatermark"?"applied":"removed";i(e.strings[o],"success"),v()}else i(a&&a.data||e.strings.error,"error")}).catch(function(){i(e.strings.error,"error")}).finally(c);else{var n=new XMLHttpRequest;n.open("POST",e.ajaxUrl,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.onreadystatechange=function(){if(n.readyState===4){if(n.status>=200&&n.status<300)try{var o=JSON.parse(n.responseText);if(o&&o.success){var y=t==="applywatermark"?"applied":"removed";i(e.strings[y],"success"),v()}else i(o&&o.data||e.strings.error,"error")}catch(h){i(e.strings.error,"error")}else i(e.strings.error,"error");c()}},n.send(r)}}};d&&d.addEventListener("click",function(s){s.preventDefault(),p("applywatermark")}),l&&l.addEventListener("click",function(s){s.preventDefault(),p("removewatermark")})}}})();
